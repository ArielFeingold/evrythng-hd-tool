{"ast":null,"code":"import _toConsumableArray from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/ariel_feingold/Developer/evrythng/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/ariel_feingold/Developer/evrythng/src/views/LoaderPage.jsx\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\nimport { withStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport AppBar from '@material-ui/core/AppBar';\nimport Collapse from '@material-ui/core/Collapse';\nimport MigrationTool from '../components/MigrationTool';\nimport TokenTool from '../components/TokenTool';\nimport MigrationReport from '../components/MigrationReport';\nimport logo from '../assets/img/hd-logo.png';\nimport bg from '../assets/img/background-upload2.jpeg';\nimport loaderPageStyle from '../assets/jss/loaderPageStyle.jsx';\n\nvar LoaderPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LoaderPage, _Component);\n\n  function LoaderPage(props) {\n    var _this;\n\n    _classCallCheck(this, LoaderPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoaderPage).call(this, props));\n\n    _this.testToken = function (token) {\n      var testTokenUser = Object.assign({}, _this.state.users[0]);\n      var url = \"https://api.kustomerapp.com/v1/customers\";\n      var headers = {\n        'Content-Type': 'application/json',\n        'Authorization': \"Bearer \".concat(token)\n      };\n      axios.post(url, testTokenUser, {\n        headers: headers\n      }).then(function (response) {\n        _this.setState({\n          tokenActive: true\n        });\n      }).catch(function (error) {\n        if (error.status === 409 || error.status === 400) {\n          _this.setState({\n            tokenActive: true\n          });\n        }\n\n        if (error.status === 401) {\n          _this.setState({\n            tokenActive: false\n          });\n        }\n      });\n    };\n\n    _this.handleUpload = function (uploadData) {\n      var dataJson = _this.csvJSON(uploadData);\n\n      _this.setState({\n        users: dataJson,\n        isUploaded: true,\n        rejectedInputs: [],\n        successfulMigrations: 0,\n        wasSent: false\n      });\n    };\n\n    _this.csvJSON = function (csv) {\n      var lines = csv.split(\"\\n\");\n      var resultArray = [];\n      var headers = [\"firstName\", \"lastName\", \"email\", \"birthdayAt\", \"homePhone\", \"workPhone\", \"customerType\"];\n\n      for (var i = 1; i < lines.length; i++) {\n        var obj = {};\n        var currentline = lines[i].replace(/, /, \"-\").split(\",\");\n\n        for (var j = 0; j < headers.length; j++) {\n          obj[headers[j]] = currentline[j];\n        }\n\n        resultArray.push(obj);\n      }\n\n      for (var _i = 0; _i < resultArray.length; _i++) {\n        var result = resultArray[_i];\n        result[\"name\"] = \"\".concat(result.firstName, \" \").concat(result.lastName);\n        delete result.firstName;\n        delete result.lastName;\n      }\n\n      return resultArray;\n    };\n\n    _this.handleMigration = function (e) {\n      e.preventDefault();\n\n      _this.setState({\n        loading: true,\n        isUploaded: false\n      });\n\n      var rawUsersData = _this.state.users;\n\n      var validUsers = _this.createUsersToSend(rawUsersData);\n\n      if (_this.state.tokenActive) {\n        validUsers.forEach(function (user, index) {\n          setTimeout(function () {\n            _this.sendInfo(user);\n          }, index * 500);\n        });\n      }\n\n      setTimeout(function () {\n        _this.setState({\n          wasSent: true,\n          loading: false\n        });\n      }, validUsers.length * 500);\n    };\n\n    _this.createUsersToSend = function (dataArray) {\n      var resultArray = [];\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = dataArray[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var user = _step.value;\n\n          var userInfo = _this.createUserInfo(user);\n\n          if (!userInfo.errors) {\n            resultArray.push(userInfo);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return resultArray;\n    };\n\n    _this.createUserInfo = function (userData) {\n      var obj = {};\n      userData.name === \" \" ? obj.name = null : obj.name = userData.name;\n\n      if (userData.email) {\n        var emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n        var cEmail = userData.email.trim();\n\n        var isValid = _this.checkRegex(emailRegex, cEmail);\n\n        if (isValid) {\n          obj.emails = [{\n            email: userData.email\n          }];\n        } else {\n          _this.createRejectObject(userData, 412, \"Precondition Failed- email format validation\", userData.email, \"notSent\");\n\n          obj.errors ? obj.errors.push({\n            email: \"Format validation failed\"\n          }) : obj.errors = [{\n            email: \"Format validation failed\"\n          }];\n        }\n      }\n\n      var phoneRegex = /^\\s*(?:\\+?(\\d{1,3}))?[-. (]*(\\d{3})[-. )]*(\\d{3})[-. ]*(\\d{4})(?: *x(\\d+))?\\s*$/;\n      obj.phones = [];\n\n      if (userData.workPhone) {\n        var cPhone = userData.workPhone.trim();\n\n        var _isValid = _this.checkRegex(phoneRegex, cPhone);\n\n        if (_isValid) {\n          obj.phones.push({\n            type: \"work\",\n            phone: userData.workPhone\n          });\n        } else {\n          _this.createRejectObject(userData, 412, \"Precondition Failed- phone format validation\", userData.workPhone, \"notSent\");\n\n          obj.errors ? obj.errors.push({\n            workPhone: \"Format validation failed\"\n          }) : obj.errors = [{\n            workPhone: \"Format validation failed\"\n          }];\n        }\n      }\n\n      if (userData.homePhone) {\n        var _cPhone = userData.homePhone.trim();\n\n        var _isValid2 = _this.checkRegex(phoneRegex, _cPhone);\n\n        if (_isValid2) {\n          obj.phones.push({\n            type: \"home\",\n            phone: userData.homePhone\n          });\n        } else {\n          _this.createRejectObject(userData, 412, \"Precondition Failed- phone format validation\", userData.homePhone, \"notSent\");\n\n          obj.errors ? obj.errors.push({\n            homePhone: \"Format validation failed\"\n          }) : obj.errors = [{\n            homePhone: \"Format validation failed\"\n          }];\n        }\n      }\n\n      if (userData.birthdayAt) {\n        var isoTime = _this.birthdayConverter(userData.birthdayAt);\n\n        obj.birthdayAt = isoTime;\n      }\n\n      ;\n\n      if (userData.customerType.length > 1) {\n        var tagRegex = /^[0-9a-zA-ZÀ-ÿ_/<>\\-.]{1}[0-9a-zA-ZÀ-ÿ _/<>\\-.]{0,63}$/;\n        var cType = userData.customerType.trim();\n\n        var _isValid3 = _this.checkRegex(tagRegex, cType);\n\n        obj.tags = [];\n\n        if (_isValid3) {\n          obj.tags.push(cType);\n        } else {\n          _this.createRejectObject(userData, 412, \"Precondition Failed- customerType format validation\", userData.customerType, \"notSent\");\n\n          obj.errors ? obj.errors.push({\n            customerType: \"Format validation failed\"\n          }) : obj.errors = [{\n            customerType: \"Format validation failed\"\n          }];\n        }\n      }\n\n      ;\n      return obj;\n    };\n\n    _this.checkRegex = function (expression, value) {\n      if (value === \"\" || expression.test(value)) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    _this.birthdayConverter = function (date) {\n      var bday = new Date(date);\n      return bday.toISOString();\n    };\n\n    _this.resetState = function (e) {\n      _this.setState({\n        users: [],\n        rejectedInputs: [],\n        isUploaded: false,\n        wasSent: false,\n        successfulMigrations: 0,\n        notSent: []\n      });\n    };\n\n    _this.state = {\n      users: [],\n      usersToSend: [],\n      rejectedInputs: [],\n      isUploaded: false,\n      wasSent: false,\n      successfulMigrations: 0,\n      tokenActive: true,\n      loading: false,\n      notSent: []\n    };\n    _this.handleTokenUpload = _this.handleTokenUpload.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  } // Token handeling\n\n\n  _createClass(LoaderPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var token = localStorage.getItem(\"token\");\n      this.testToken(token);\n    }\n  }, {\n    key: \"handleTokenUpload\",\n    value: function handleTokenUpload(token) {\n      localStorage.setItem(\"token\", token);\n      this.testToken();\n    }\n  }, {\n    key: \"sendInfo\",\n    value: function () {\n      var _sendInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(data) {\n        var _this2 = this;\n\n        var url, token, headers;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = \"https://api.kustomerapp.com/v1/customers\";\n                token = localStorage.getItem(\"token\");\n                headers = {\n                  'Content-Type': 'application/json',\n                  'Authorization': \"Bearer \".concat(token)\n                };\n                axios.post(url, data, {\n                  headers: headers\n                }).then(function (response) {\n                  _this2.setState({\n                    successfulMigrations: _this2.state.successfulMigrations + 1\n                  });\n                }).catch(function (error) {\n                  var errorArray = error.response.data.errors;\n                  var _iteratorNormalCompletion2 = true;\n                  var _didIteratorError2 = false;\n                  var _iteratorError2 = undefined;\n\n                  try {\n                    for (var _iterator2 = errorArray[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                      var err = _step2.value;\n                      var errUser = JSON.parse(error.config.data);\n\n                      _this2.createRejectObject(errUser, err.status, err.title, err.source.pointer, \"rejectedInputs\");\n                    }\n                  } catch (err) {\n                    _didIteratorError2 = true;\n                    _iteratorError2 = err;\n                  } finally {\n                    try {\n                      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                        _iterator2.return();\n                      }\n                    } finally {\n                      if (_didIteratorError2) {\n                        throw _iteratorError2;\n                      }\n                    }\n                  }\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function sendInfo(_x) {\n        return _sendInfo.apply(this, arguments);\n      }\n\n      return sendInfo;\n    }()\n  }, {\n    key: \"createRejectObject\",\n    value: function createRejectObject(user, errorCode, errorTitle, errorSource, stateElement) {\n      var rejectedUser = {\n        user: user,\n        error: {\n          statusCode: errorCode,\n          title: errorTitle,\n          source: errorSource\n        }\n      };\n\n      if (stateElement === \"rejectedInputs\") {\n        this.setState({\n          rejectedInputs: [].concat(_toConsumableArray(this.state.rejectedInputs), [rejectedUser])\n        });\n      }\n\n      if (stateElement === \"notSent\") {\n        this.setState({\n          notSent: [].concat(_toConsumableArray(this.state.notSent), [rejectedUser])\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var classes = this.props.classes;\n      return React.createElement(\"div\", {\n        className: classes.root,\n        style: {\n          backgroundImage: \"url(\" + bg + \")\",\n          backgroundSize: \"cover\",\n          backgroundPosition: \"top center\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, React.createElement(TokenTool, {\n        tokenActive: this.state.tokenActive,\n        handleTokenUpload: this.handleTokenUpload,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      }), React.createElement(AppBar, {\n        className: classes.header,\n        position: \"static\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: classes.logo,\n        src: logo,\n        alt: \"Kustomer Logo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289\n        },\n        __self: this\n      })), React.createElement(AppBar, {\n        position: \"static\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, React.createElement(Collapse, {\n        in: this.state.isUploaded,\n        collapsedHeight: \"0px\",\n        timeout: \"auto\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: classes.successBanner,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294\n        },\n        __self: this\n      }, \"Success! \", this.state.users.length, \" customers were imported. Press \\\"MIGRATE\\\" to continue\"))), React.createElement(Grid, {\n        container: true,\n        justify: \"space-evenly\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, React.createElement(MigrationTool, {\n        handleUpload: this.handleUpload,\n        handleMigration: this.handleMigration,\n        isUploaded: this.state.isUploaded,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      }), React.createElement(MigrationReport, {\n        reset: function reset() {\n          return _this3.resetState();\n        },\n        rejectedInputs: this.state.rejectedInputs,\n        notSent: this.state.notSent,\n        wasSent: this.state.wasSent,\n        successfulMigrations: this.state.successfulMigrations,\n        isLoading: this.state.loading,\n        loaderLength: this.state.users.length,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return LoaderPage;\n}(Component);\n\nLoaderPage.propTypes = {\n  classes: PropTypes.object.isRequired\n};\nexport default withStyles(loaderPageStyle)(LoaderPage);","map":{"version":3,"sources":["/Users/ariel_feingold/Developer/evrythng/src/views/LoaderPage.jsx"],"names":["React","Component","PropTypes","axios","withStyles","Grid","AppBar","Collapse","MigrationTool","TokenTool","MigrationReport","logo","bg","loaderPageStyle","LoaderPage","props","testToken","token","testTokenUser","Object","assign","state","users","url","headers","post","then","response","setState","tokenActive","catch","error","status","handleUpload","uploadData","dataJson","csvJSON","isUploaded","rejectedInputs","successfulMigrations","wasSent","csv","lines","split","resultArray","i","length","obj","currentline","replace","j","push","result","firstName","lastName","handleMigration","e","preventDefault","loading","rawUsersData","validUsers","createUsersToSend","forEach","user","index","setTimeout","sendInfo","dataArray","userInfo","createUserInfo","errors","userData","name","email","emailRegex","cEmail","trim","isValid","checkRegex","emails","createRejectObject","phoneRegex","phones","workPhone","cPhone","type","phone","homePhone","birthdayAt","isoTime","birthdayConverter","customerType","tagRegex","cType","tags","expression","value","test","date","bday","Date","toISOString","resetState","notSent","usersToSend","handleTokenUpload","bind","localStorage","getItem","setItem","data","errorArray","err","errUser","JSON","parse","config","title","source","pointer","errorCode","errorTitle","errorSource","stateElement","rejectedUser","statusCode","classes","root","backgroundImage","backgroundSize","backgroundPosition","header","successBanner","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport AppBar from '@material-ui/core/AppBar';\nimport Collapse from '@material-ui/core/Collapse';\n\nimport MigrationTool from '../components/MigrationTool'\nimport TokenTool from '../components/TokenTool'\nimport MigrationReport from '../components/MigrationReport'\n\nimport logo from '../assets/img/hd-logo.png';\nimport bg from '../assets/img/background-upload2.jpeg';\nimport loaderPageStyle from '../assets/jss/loaderPageStyle.jsx'\n\n\nclass LoaderPage extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      users: [],\n      usersToSend: [],\n      rejectedInputs: [],\n      isUploaded: false,\n      wasSent: false,\n      successfulMigrations: 0,\n      tokenActive: true,\n      loading: false,\n      notSent: []\n    };\n\n    this.handleTokenUpload = this.handleTokenUpload.bind(this);\n  }\n\n// Token handeling\n  componentDidMount() {\n    const token = localStorage.getItem(\"token\");\n    this.testToken(token);\n  }\n\n  handleTokenUpload(token) {\n    localStorage.setItem(\"token\", token);\n    this.testToken()\n  }\n\n  testToken = (token) => {\n    const testTokenUser = Object.assign({}, this.state.users[0]);\n    const url = `https://api.kustomerapp.com/v1/customers`\n    const headers = {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`};\n\n    axios.post(url, testTokenUser, {headers: headers} )\n    .then(response => {\n      this.setState({\n        tokenActive: true\n      })\n    })\n    .catch(error => {\n        if(error.status === 409 || error.status === 400){\n          this.setState({\n            tokenActive: true\n          })\n        }\n        if(error.status === 401) {\n          this.setState({\n            tokenActive: false,\n          })\n        }\n      }\n    )\n  }\n\n// CSV upload\n  handleUpload = (uploadData) => {\n    const dataJson = this.csvJSON(uploadData)\n    this.setState({\n      users: dataJson,\n      isUploaded: true,\n      rejectedInputs: [],\n      successfulMigrations: 0,\n      wasSent: false\n    });\n  }\n\n  csvJSON = (csv) => {\n\n    const lines=csv.split(\"\\n\");\n    const resultArray = [];\n    const headers=[\"firstName\", \"lastName\", \"email\", \"birthdayAt\", \"homePhone\", \"workPhone\", \"customerType\"];\n    for(let i=1; i<lines.length; i++){\n  \t  const obj = {};\n  \t  const currentline=lines[i].replace(/, /, \"-\").split(\",\");\n\n  \t  for(let j=0; j<headers.length; j++){\n  \t\t  obj[headers[j]] = currentline[j];\n  \t  }\n  \t  resultArray.push(obj);\n    }\n    for(let result of resultArray){\n      result[\"name\"] = `${result.firstName} ${result.lastName}`;\n      delete result.firstName;\n      delete result.lastName\n    }\n    return resultArray;\n  }\n\n// Data manipulation & migration to Kustomer servers\n  handleMigration = (e) => {\n    e.preventDefault()\n      this.setState({ loading: true, isUploaded: false})\n      let rawUsersData = this.state.users;\n      let validUsers = this.createUsersToSend(rawUsersData)\n\n      if(this.state.tokenActive) {\n        validUsers.forEach((user, index) => {\n          setTimeout(() => {\n              this.sendInfo(user);\n          }, index * 500);\n        });\n      }\n      setTimeout(() => {\n        this.setState({ wasSent: true, loading: false  });\n      }, validUsers.length * 500)\n  }\n\n  createUsersToSend = (dataArray) => {\n    const resultArray = [];\n    for(let user of dataArray){\n      const userInfo = this.createUserInfo(user)\n\n      if(!userInfo.errors) {\n        resultArray.push(userInfo)\n      }\n    }\n    return resultArray;\n  }\n\n  createUserInfo = (userData) => {\n    const obj = {};\n\n    userData.name === \" \" ? obj.name = null : obj.name = userData.name;\n\n    if(userData.email) {\n      const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/\n      const cEmail = userData.email.trim()\n      const isValid = this.checkRegex(emailRegex, cEmail)\n      if(isValid) {\n        obj.emails = [{email: userData.email}]\n      } else {\n        this.createRejectObject(userData, 412 , \"Precondition Failed- email format validation\", userData.email, \"notSent\")\n        obj.errors ? obj.errors.push({email: \"Format validation failed\"}) : obj.errors = [{email: \"Format validation failed\"}]\n      }\n    }\n\n    const phoneRegex = /^\\s*(?:\\+?(\\d{1,3}))?[-. (]*(\\d{3})[-. )]*(\\d{3})[-. ]*(\\d{4})(?: *x(\\d+))?\\s*$/;\n    obj.phones = [];\n\n    if(userData.workPhone) {\n      const cPhone = userData.workPhone.trim()\n      const isValid = this.checkRegex(phoneRegex, cPhone)\n      if(isValid) {\n        obj.phones.push({type: \"work\", phone: userData.workPhone})\n        } else {\n        this.createRejectObject(userData, 412, \"Precondition Failed- phone format validation\", userData.workPhone, \"notSent\")\n        obj.errors ? obj.errors.push({workPhone: \"Format validation failed\"}) : obj.errors = [{workPhone: \"Format validation failed\"}]\n      }\n    }\n\n    if(userData.homePhone) {\n      const cPhone = userData.homePhone.trim()\n      const isValid = this.checkRegex(phoneRegex, cPhone)\n      if(isValid) {\n        obj.phones.push({type: \"home\", phone: userData.homePhone})\n      } else {\n        this.createRejectObject(userData, 412, \"Precondition Failed- phone format validation\", userData.homePhone, \"notSent\")\n        obj.errors ? obj.errors.push({homePhone: \"Format validation failed\"}) : obj.errors = [{homePhone: \"Format validation failed\"}]\n      }\n    }\n\n    if(userData.birthdayAt) {\n      const isoTime = this.birthdayConverter(userData.birthdayAt);\n      obj.birthdayAt = isoTime\n    };\n\n    if(userData.customerType.length > 1){\n      const tagRegex = /^[0-9a-zA-ZÀ-ÿ_/<>\\-.]{1}[0-9a-zA-ZÀ-ÿ _/<>\\-.]{0,63}$/\n      const cType = userData.customerType.trim()\n      const isValid = this.checkRegex(tagRegex, cType)\n      obj.tags = []\n      if(isValid) {\n        obj.tags.push(cType)\n        } else {\n        this.createRejectObject(userData, 412, \"Precondition Failed- customerType format validation\", userData.customerType, \"notSent\")\n        obj.errors ? obj.errors.push({customerType: \"Format validation failed\"}) : obj.errors = [{customerType: \"Format validation failed\"}]\n      }\n    };\n\n    return obj;\n  }\n\n  async sendInfo(data) {\n    const url = `https://api.kustomerapp.com/v1/customers`\n    const token = localStorage.getItem(\"token\");\n    const headers = {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`};\n    axios.post(url, data, {headers: headers} )\n    .then(response => {\n      this.setState({\n        successfulMigrations: this.state.successfulMigrations + 1\n      })\n    })\n    .catch(error => {\n      const errorArray = error.response.data.errors;\n      for(let err of errorArray) {\n        const errUser = JSON.parse(error.config.data);\n        this.createRejectObject(errUser, err.status, err.title, err.source.pointer, \"rejectedInputs\")\n      }\n    })\n  }\n\n  createRejectObject(user, errorCode, errorTitle, errorSource, stateElement) {\n    const rejectedUser =\n        { user: user,\n          error: {\n            statusCode: errorCode,\n            title: errorTitle,\n            source: errorSource\n          }\n        }\n    if(stateElement === \"rejectedInputs\") {\n      this.setState({\n        rejectedInputs: [...this.state.rejectedInputs, rejectedUser]\n      })\n    }\n    if(stateElement === \"notSent\") {\n      this.setState({\n        notSent: [...this.state.notSent, rejectedUser]\n      })\n    }\n  }\n\n  checkRegex = (expression, value) => {\n    if(value === \"\" || expression.test(value)) {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  birthdayConverter = (date) => {\n    const bday = new Date(date);\n    return bday.toISOString()\n  }\n\n  resetState = (e) => {\n    this.setState ({\n      users: [],\n      rejectedInputs: [],\n      isUploaded: false,\n      wasSent: false,\n      successfulMigrations: 0,\n      notSent: []\n    })\n  }\n\n  render() {\n    const { classes } = this.props;\n\n    return (\n        <div\n          className={classes.root}\n          style={{\n            backgroundImage: \"url(\" + bg + \")\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"top center\"\n          }}>\n\n          <TokenTool\n            tokenActive={this.state.tokenActive}\n            handleTokenUpload={this.handleTokenUpload}\n          />\n\n          <AppBar\n            className={classes.header}\n            position=\"static\"\n          >\n            <img className={classes.logo} src={logo} alt=\"Kustomer Logo\" />\n          </AppBar>\n\n          <AppBar position=\"static\">\n            <Collapse in={this.state.isUploaded} collapsedHeight=\"0px\" timeout=\"auto\">\n              <div className={classes.successBanner}>Success! {this.state.users.length} customers were imported. Press \"MIGRATE\" to continue</div>\n            </Collapse>\n          </AppBar>\n\n          <Grid container justify = \"space-evenly\">\n            <MigrationTool\n              handleUpload={this.handleUpload}\n              handleMigration={this.handleMigration}\n              isUploaded={this.state.isUploaded}\n              />\n\n            <MigrationReport\n              reset={() => this.resetState()}\n              rejectedInputs={this.state.rejectedInputs}\n              notSent={this.state.notSent}\n              wasSent={this.state.wasSent}\n              successfulMigrations={this.state.successfulMigrations}\n              isLoading={this.state.loading}\n              loaderLength  ={this.state.users.length}\n            />\n          </Grid>\n        </div>\n      );\n    }\n  }\n\n  LoaderPage.propTypes = {\n    classes: PropTypes.object.isRequired,\n  };\n\nexport default withStyles(loaderPageStyle)(LoaderPage);\n"]},"metadata":{},"sourceType":"module"}